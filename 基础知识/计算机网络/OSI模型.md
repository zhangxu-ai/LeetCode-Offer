# OSI 7层模型

OSI7层模型是iso提出的一个理论上的分层模型

OSI是一个**完整的、完善的宏观模型**，他包括了硬件层（物理层），当然也包含了很多上面途中没有列出的协议(比如DNS解析协议等)；而TCP/IP（参考）模型，更加侧重的是互联网通信核心（也是就是围绕TCP/IP协议展开的一系列**通信协议**）的分层，因此它不包括物理层，以及其他一些不相干的协议；其次，之所以说他是参考模型，是因为他本身也**是OSI模型中的一部分**，因此参考OSI模型对其分层。

![osi](https://upload-images.jianshu.io/upload_images/2179030-3694fe2b18ebe05f.png?imageMogr2/auto-orient/strip|imageView2/2/w/960/format/webp)

## 1. 物理层

通过光缆、电缆、无线电波等方式，将设备连接起来

两个不同的局域网进行通信，需要ISP 互联网服务提供商的物理连接

作用：传送**比特流** 0 和 1

## 2. 数据链路层

1. 规定了物理层中 0 和 1 的协议（发送和解读的方式）
2. 一组信号叫一个 `帧(Frame)`,包括头部和数据；头部包括数据的一些附加信息，如发送者和接收者
3. MAC地址：
   1. 唯一确定发送者和接收者的标识符
   2. 网卡的地址，独一无二
4. 广播
   1. 通过ARP协议获取目标地址的mac地址
   2. **广播到本地局域网的所有主机上**，通过头部取得mac地址，由他们进行判断是否是发给自己的，如果不是就丢弃
   3. 发送的媒介是 分组交换机/网络交换机
5. ARP协议
   1. 获取**局域网**内 ip 和 mac 地址的对应关系，即知道了ip，获取其mac地址
   2. 在局域网内广播找人
6. 网络交换机：为子网提供更多的接口，从而连接上更多的pc，在子网内部通信，根据mac地址进行转发
7. 数据为：将网络层发送的 ip数据报加上头部(mac地址)，组成 **帧**

## 3. 网络层

建立 主机-主机之间的连接

如果两台计算机没有在同一个子网（局域网）内，是无法通过广播直接传过去的。

如果是同一个子网就采用广播的形式，如果不是，则采用“路由”的方式发送——这就导致了网络层的出现，

引入一套新的地址，使我们能够区分哪些计算机属于同一个子网，这个套机制就叫做“网络地址”，也就是“IP地址”。

1. IP地址
   1. 规定网络地址的协议，叫IP协议。他定义的地址，就叫做“IP地址”
   2. ipv4网络地址由**32个二进制位**组成,习惯上，我们分成四段十进制数表示IPV4地址，从0.0.0.0到255.255.255.255。ipv6由128个二进制位组成，8字节*16位
2. 子网掩码
   1. 通过and运算判断是否在同一子网下
3. 路由
   1. 通过网络把数据传输到目的地址
   2. 定义一条路径，经过因特网发送包到另一网络上的地址
   3. 但不是完全路径，而是只定义从主机到可以将包转发到目的地的网关 间的 路径段
   4. 路由器：连接多个网络的设备，具有多个网卡的电脑
4. 网关：子网的出口，一种虚拟概念，和具体设备无关；路由器可以实现网关的功能；
5. 在发送数据时，网络层把运输层产生的**报文段或用户数据报**封装成分组和包进行传送。在 TCP/IP 体系结构中，由于网络层使用 IP 协议，因此分组也叫 **IP 数据报** ，简称 数据报。

## 4. 传输层

建立 `端口到端口` 的通信，即确定数据是 发给/接收于 哪个进程的,因为端口一次只能和1个进程绑定的。

1. `端口号`为 0-65535，用户只能使用1023以上的端口号
2. `socket`
   1. 作用于进程间通信，包括同一主机的进程间或者不同主机的进程间，需要 ip+port+protocol
   2. 格式是一个**无符号整型变量**，用来表示一个通信进程；在linux中，也叫文件描述符
   3. 本质是一个API，对TCP/IP协议的封装，我们可以直接在程序中调用他的函数，如 listen,accept,sent,write等，而不需要自己实现
3. 使用的`协议`：TCP/UDP
   1. TCP,传输控制协议(transmission control protocol)，面向连接(先建立连接再发数据)，提供可靠的传输服务(各种机制保障数据包的成功发送，每一个包确认一下，如果没有收到，就重发)
   2. UDP,用户数据协议(user datagram protocol)，无连接(不建立连接,直接发送数据)；不保证数据传输的可靠性(不确认数据是否收到)
4. 将应用层的 数据 加上 TCP/UDP 的首部，组成 `段`(tcp)或`数据报`(udp)

## 5. 应用层

将上面3层可以合并为 TCP/IP模型 中的应用层

1. 最上层，直接面向用户，或者就是我们开发的程序
2. 规定应用程序的协议格式，如http协议，ftp协议，stmp协议，ssh协议等
3. 将数据按照以上的协议组装好，成为 `数据`

## 数据流向

![data](https://upload-images.jianshu.io/upload_images/2179030-b2b03e6a8075255e.png?imageMogr2/auto-orient/strip|imageView2/2/w/726/format/webp)
